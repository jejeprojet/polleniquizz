<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jeu : Trouve l'intrus - Les H√©ros Invisibles</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Savate', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      background-image: url('fond.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: #2c3e50;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* Overlay pour am√©liorer la lisibilit√© */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(1px);
      z-index: -1;
    }

    /* Container principal avec scroll interne si n√©cessaire */
    .container {
      max-width: 100vw;
      height: 100vh;
      padding: 8px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: hidden;
    }

    /* Titre principal */
    h1 {
      color: #2d5a27;
      font-size: clamp(1.2rem, 3.5vw, 2rem);
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
      font-weight: 700;
    }

    .subtitle {
      color: #2d5a27;
      font-size: clamp(0.75rem, 2vw, 0.9rem);
      margin-bottom: 15px;
      font-weight: 500;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }

    /* Boutons de niveau */
    #level-buttons {
      margin: 10px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }

    #level-buttons button {
      padding: clamp(8px, 2vh, 12px) clamp(12px, 3vw, 20px);
      background: linear-gradient(45deg, #4CAF50, #66BB6A);
      border: 2px solid #388E3C;
      color: #fff;
      border-radius: 20px;
      cursor: pointer;
      font-size: clamp(0.7rem, 2vw, 0.9rem);
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(76, 175, 80, 0.4);
      min-width: clamp(100px, 25vw, 140px);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    #level-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.6);
      background: linear-gradient(45deg, #66BB6A, #4CAF50);
    }

    /* Score */
    .score {
      font-size: clamp(0.9rem, 2.5vw, 1.2rem);
      margin: 8px 0;
      color: #2d5a27;
      font-weight: 700;
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(5px);
      border-radius: 15px;
      padding: clamp(6px, 1.5vh, 10px) clamp(12px, 3vw, 16px);
      display: inline-block;
      border: 2px solid #4CAF50;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }

    /* Zone de jeu - taille adaptative */
    .game-area {
      display: grid;
      gap: clamp(6px, 1.5vw, 12px);
      margin: 10px auto;
      padding: 0 5px;
      flex: 1;
      align-content: start;
      max-width: 100%;
    }

    /* Grilles responsive selon le nombre d'√©l√©ments */
    .game-area.choices-4 {
      grid-template-columns: repeat(2, 1fr);
      max-width: clamp(280px, 60vw, 400px);
    }

    .game-area.choices-6 {
      grid-template-columns: repeat(3, 1fr);
      max-width: clamp(360px, 80vw, 600px);
    }

    .game-area.choices-8 {
      grid-template-columns: repeat(4, 1fr);
      max-width: clamp(400px, 90vw, 800px);
    }

    /* Cartes des esp√®ces */
    .item {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(8px);
      border: 2px solid #4CAF50;
      border-radius: 15px;
      height: clamp(110px, 18vh, 150px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      padding: clamp(4px, 1vh, 8px);
      position: relative;
      overflow: hidden;
    }

    .item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }

    .item:hover::before {
      left: 100%;
    }

    .item:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      border-color: #2E7D32;
    }

    .item img {
      max-width: 85%;
      max-height: 65%;
      object-fit: cover;
      border-radius: 8px;
      transition: transform 0.3s ease;
    }

    .item:hover img {
      transform: scale(1.05);
    }

    .item-name {
      font-size: clamp(0.6rem, 1.8vw, 0.75rem);
      font-weight: 600;
      color: #2c3e50;
      text-align: center;
      line-height: 1.1;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
      padding: 2px 4px;
      background: rgba(255,255,255,0.8);
      border-radius: 8px;
      margin: 2px;
    }

    /* Messages */
    .message {
      margin: 8px auto;
      font-weight: 600;
      font-size: clamp(0.8rem, 2.2vw, 1rem);
      padding: clamp(6px, 1.5vh, 10px) clamp(10px, 2.5vw, 15px);
      border-radius: 12px;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(5px);
      border: 2px solid #4CAF50;
      color: #2d5a27;
      max-width: 90%;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }

    /* Bouton suivant */
    .next-button {
      margin: 10px auto;
      padding: clamp(8px, 2vh, 12px) clamp(16px, 4vw, 24px);
      background: linear-gradient(45deg, #FF9800, #FF7043);
      border: 2px solid #E65100;
      color: #fff;
      border-radius: 20px;
      cursor: pointer;
      font-size: clamp(0.8rem, 2.2vw, 1rem);
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      display: none;
      font-family: inherit;
    }

    .next-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 152, 0, 0.6);
      background: linear-gradient(45deg, #FF7043, #FF9800);
    }

    /* Zone d'informations - bien visible sur mobile */
    .info {
      margin: 15px auto 10px;
      font-size: clamp(0.85rem, 2.2vw, 1rem);
      text-align: left;
      padding: clamp(12px, 3vh, 16px);
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(8px);
      border: 3px solid #4CAF50;
      border-radius: 15px;
      max-width: 95%;
      line-height: 1.4;
      white-space: pre-line;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      min-height: 30vh;
      max-height: 40vh;
      overflow-y: auto;
    }

    .info img {
      width: 100%;
      max-width: clamp(150px, 40vw, 250px);
      border-radius: 12px;
      margin-bottom: 15px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 15px rgba(0,0,0,0.25);
    }

    .info-text {
      color: #2c3e50;
      font-weight: 600;
      font-size: clamp(0.9rem, 2.3vw, 1.1rem);
    }

    /* Messages de succ√®s/erreur */
    .message.success {
      background: linear-gradient(45deg, #4CAF50, #66BB6A);
      color: white;
      border-color: #2E7D32;
      animation: pulse 0.6s ease;
    }

    .message.error {
      background: linear-gradient(45deg, #F44336, #EF5350);
      color: white;
      border-color: #C62828;
      animation: shake 0.6s ease;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.03); }
      100% { transform: scale(1); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      75% { transform: translateX(3px); }
    }

    /* Responsive sp√©cifique mobile */
    @media (max-width: 768px) {
      .container {
        padding: 5px;
      }
      
      .game-area.choices-6 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .game-area.choices-8 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .info {
        min-height: 35vh;
        max-height: 45vh;
        margin: 20px auto 15px;
        font-size: clamp(0.9rem, 2.5vw, 1.1rem);
      }
      
      .info-text {
        font-size: clamp(0.95rem, 2.6vw, 1.15rem);
        line-height: 1.5;
      }
    }

    @media (max-width: 480px) {
      .game-area.choices-8 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      #level-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      #level-buttons button {
        width: 90%;
        max-width: 250px;
      }
      
      .info {
        min-height: 40vh;
        max-height: 50vh;
        margin: 25px auto 20px;
      }
      
      .info-text {
        font-size: clamp(1rem, 2.8vw, 1.2rem);
      }
    }

    /* Tr√®s petit √©cran */
    @media (max-height: 600px) {
      h1 {
        font-size: clamp(1rem, 3vw, 1.5rem);
        margin-bottom: 2px;
      }
      
      .subtitle {
        font-size: clamp(0.65rem, 1.8vw, 0.8rem);
        margin-bottom: 8px;
      }
      
      .info {
        min-height: 25vh;
        max-height: 35vh;
      }
    }

    /* Animations d'entr√©e */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .item {
      animation: fadeInUp 0.4s ease forwards;
    }

    .item:nth-child(2) { animation-delay: 0.05s; }
    .item:nth-child(3) { animation-delay: 0.1s; }
    .item:nth-child(4) { animation-delay: 0.15s; }
    .item:nth-child(5) { animation-delay: 0.2s; }
    .item:nth-child(6) { animation-delay: 0.25s; }
    .item:nth-child(7) { animation-delay: 0.3s; }
    .item:nth-child(8) { animation-delay: 0.35s; }

    /* Am√©lioration du contraste pour l'accessibilit√© */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Masquer la scrollbar mais garder la fonctionnalit√© */
    .container::-webkit-scrollbar {
      width: 0px;
      background: transparent;
    }

    .info::-webkit-scrollbar {
      width: 3px;
    }

    .info::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
    }

    .info::-webkit-scrollbar-thumb {
      background: #4CAF50;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåø Trouve l'intrus : Les H√©ros Invisibles üåø</h1>
    <p class="subtitle">Le but ? D√©masquer l'esp√®ce en danger pour mieux la prot√©ger !</p>
    
    <div id="level-buttons">
      <button onclick="startGame('facile')">üü¢ Facile (4 choix)</button>
      <button onclick="startGame('moyen')">üü° Moyen (6 choix)</button>
      <button onclick="startGame('difficile')">üî¥ Difficile (8 choix)</button>
    </div>
    
    <div class="score" id="scoreDisplay" style="display:none;">Score : 0</div>
    <div class="game-area" id="gameArea"></div>
    <div class="message" id="message"></div>
    <button class="next-button" id="nextButton" onclick="nextRound()">Question suivante ‚û°Ô∏è</button>
    <div class="info" id="info"></div>
  </div>

  <script>
    // === LISTES DES ESP√àCES ===
    
    // ü¶∏ Intrus (esp√®ces menac√©es √† prot√©ger)
    const endangeredSpecies = [
      "M√©lib√©e",
      "Vanesse des pari√©taires", 
      "Agrion bleuissant",
      "Cordulie splendide",
      "Serratella mesoleuca",
      "Halictus carinthiacus",
      "Bourdon velout√©",
      "Criquet de la Crau",
      "Phasme du palmiste rouge",
      "Dendrobias maxillosus"
    ];

    // üêû D√©coys (esp√®ces non menac√©es)
    const commonSpecies = [
      "Chauve-souris frugivore",
      "Colibri",
      "Mouche domestique",
      "Fourmi noire",
      "Papillon commun",
      "Abeille domestique",
      "Sauterelle verte",
      "Scarab√©e commun",
      "Coccinelle √† sept point",
      "Termite des for√™ts",
      "Grillon champ√™tre",
      "Larve de coccinelle",
      "Cicadelle",
      "Lucane cerf volant",
      "Punaise verte",
      "Mite des v√™tements",
      "Perce-oreille",
      "Loup",
      "Renard",
      "Chat",
      "Chien",
      "Pigeon"
    ];

    // === D√âFINITIONS ET GESTES DE PROTECTION ===
    const definitions = {
      // Esp√®ces menac√©es
      "M√©lib√©e": `ü¶ã **M√©lib√©e**
1. Papillon rare des prairies humides, reconnaissable √† ses ailes oranges tachet√©es de noir.
2. Pollinisateur sp√©cialis√© des fleurs de prairie, indispensable √† la biodiversit√© montagnarde.
3. Menac√© par l'ass√®chement des zones humides et l'agriculture intensive.
**Gestes** : Pr√©serve les prairies fleuries, √©vite les pesticides, cr√©e des corridors verts.`,

      "Vanesse des pari√©taires": `ü¶ã **Vanesse des pari√©taires**
1. Papillon aux ailes d√©coup√©es, d√©pendant exclusivement de la pari√©taire officinale.
2. Exemple parfait de co√©volution : chenille-plante h√¥te indissociables.
3. Menac√©e par le nettoyage urbain et l'usage d'herbicides.
**Gestes** : Laisse pousser la pari√©taire sur tes murs, √©vite les d√©sherbants chimiques.`,

      "Agrion bleuissant": `üíß **Agrion bleuissant**
1. Petite libellule bleue vivant pr√®s des cours d'eau clairs et oxyg√©n√©s.
2. Pr√©dateur de moustiques efficace, indicateur de qualit√© des milieux aquatiques.
3. Menac√© par la pollution de l'eau et l'artificialisation des berges.
**Gestes** : Prot√®ge les ruisseaux, √©vite les produits chimiques pr√®s de l'eau.`,

      "Cordulie splendide": `‚ú® **Cordulie splendide**
1. Libellule m√©tallique des mares temporaires m√©diterran√©ennes.
2. Vol spectaculaire et chasse a√©rienne remarquable contre les insectes nuisibles.
3. Menac√©e par la disparition des zones humides temporaires.
**Gestes** : Cr√©e des mares naturelles, respecte les flaques temporaires.`,

      "Serratella mesoleuca": `üí¶ **Serratella mesoleuca**
1. √âph√©m√®re aux larves aquatiques, vie adulte de quelques heures seulement.
2. Maillon essentiel de la cha√Æne alimentaire des rivi√®res.
3. Menac√©e par la pollution et la modification des cours d'eau.
**Gestes** : Prot√®ge la v√©g√©tation des berges, √©vite les rejets polluants.`,

      "Halictus carinthiacus": `üêù **Halictus carinthiacus**
1. Abeille sauvage solitaire, excellente pollinisatrice des fleurs alpines.
2. Creuse ses nids dans le sol, plus efficace que l'abeille domestique sur certaines fleurs.
3. Menac√©e par l'urbanisation et le pi√©tinement des sols.
**Gestes** : Pr√©serve les sols nus, plante des fleurs locales, √©vite le b√™chage.`,

      "Bourdon velout√©": `üêù **Bourdon velout√©**
1. Bourdon au pelage dense, sp√©cialis√© dans la pollinisation par vibration.
2. Pollinisateur irrempla√ßable des tomates et autres solanac√©es.
3. Menac√© par les pesticides et la rar√©faction des fleurs sauvages.
**Gestes** : Plante des fleurs mellif√®res, bannis les insecticides, cr√©e des abris.`,

      "Criquet de la Crau": `ü¶ó **Criquet de la Crau**
1. Criquet end√©mique de la plaine de la Crau, habitat unique au monde.
2. Indicateur de la sant√© des √©cosyst√®mes de coussouls (pelouses s√®ches).
3. Menac√© par l'urbanisation et l'agriculture intensive.
**Gestes** : Soutiens la protection des espaces naturels, respecte les pelouses s√®ches.`,

      "Phasme du palmiste rouge": `üåø **Phasme du palmiste rouge**
1. Insecte-b√¢ton tropical, ma√Ætre du camouflage dans les palmiers.
2. Herbivore sp√©cialis√©, participant √† l'√©quilibre des for√™ts tropicales.
3. Menac√© par la d√©forestation et les esp√®ces invasives.
**Gestes** : Soutiens la protection des for√™ts tropicales, choisis des produits durables.`,

      "Dendrobias maxillosus": `ü™≤ **Dendrobias maxillosus**
1. Col√©opt√®re saproxylique, d√©composeur de bois mort essentiel.
2. Indicateur de la qualit√© des vieilles for√™ts, recycleur naturel.
3. Menac√© par l'exploitation foresti√®re intensive et le nettoyage des for√™ts.
**Gestes** : Laisse du bois mort en for√™t, soutiens la gestion durable des for√™ts.`,

      // Esp√®ces communes (descriptions plus courtes)
      "Chauve-souris frugivore": `ü¶á **Chauve-souris frugivore**
Mammif√®re volant, disperse les graines des fruits.
Population stable, adaptable aux environnements vari√©s.`,

      "Colibri": `üê¶ **Colibri**
Oiseau-mouche, pollinisateur de fleurs tubulaires.
Esp√®ce commune dans son habitat naturel.`,

      "Mouche domestique": `ü™∞ **Mouche domestique**
Insecte ubiquiste, recycle la mati√®re organique.
Tr√®s commune, non menac√©e.`,

      "Fourmi noire": `üêú **Fourmi noire**
Insecte social, a√®re le sol et disperse les graines.
Population abondante et stable.`,

      "Papillon commun": `ü¶ã **Papillon commun**
Pi√©ride blanche, pollinisateur occasionnel des jardins.
Tr√®s r√©pandu, population en bonne sant√©.`,

      "Abeille domestique": `üêù **Abeille domestique**
Hym√©nopt√®re √©lev√© par l'homme, pollinisateur efficace.
G√©r√©e par l'apiculture, non sauvage.`,

      "Sauterelle verte": `ü¶ó **Sauterelle verte**
Orthopt√®re herbivore des prairies et jardins.
Commune partout, tr√®s adaptable.`,

      "Scarab√©e commun": `ü™≤ **Scarab√©e commun**
Col√©opt√®re d√©composeur, recycle la mati√®re organique.
Population stable, pas de menace particuli√®re.`,

      "Coccinelle √† sept point": `üêû **Coccinelle √† sept point**
Pr√©dateur naturel des pucerons, auxiliaire du jardinier.
Tr√®s commune, non menac√©e.`,

      "Termite des for√™ts": `üêú **Termite des for√™ts**
Insecte social d√©composeur, recycle le bois mort.
Population stable dans les for√™ts.`,

      "Grillon champ√™tre": `ü¶ó **Grillon champ√™tre**
Orthopt√®re chanteur des prairies et jardins.
Tr√®s commun, non menac√©.`,

      "Larve de coccinelle": `üêõ **Larve de coccinelle**
Stade juv√©nile de coccinelle, grand pr√©dateur de pucerons.
Abondante, non menac√©e.`,

      "Cicadelle": `ü¶ó **Cicadelle**
Petit insecte sauteur se nourrissant de s√®ve.
Tr√®s commune, non menac√©e.`,

      "Lucane cerf volant": `ü™≤ **Lucane cerf volant**
Grand col√©opt√®re aux mandibules impressionnantes.
Relativement commun, non menac√© globalement.`,

      "Punaise verte": `üêõ **Punaise verte**
Insecte herbivore des jardins et cultures.
Tr√®s commune, parfois consid√©r√©e comme nuisible.`,

      "Mite des v√™tements": `ü¶ã **Mite des v√™tements**
Petit papillon dont la larve mange les textiles.
Tr√®s commune dans les habitations.`,

      "Perce-oreille": `ü¶ó **Perce-oreille**
Insecte aux pinces caract√©ristiques, omnivore.
Tr√®s commun, non menac√©.`,

      "Loup": `üê∫ **Loup**
Mammif√®re carnivore, pr√©dateur apex.
Population en r√©cup√©ration, non insecte.`,

      "Renard": `ü¶ä **Renard**
Mammif√®re omnivore adaptable.
Population stable, non insecte.`,

      "Chat": `üê± **Chat**
Mammif√®re domestique, pr√©dateur d'oiseaux et petits animaux.
Tr√®s commun, non insecte.`,

      "Chien": `üê∂ **Chien**
Mammif√®re domestique, compagnon de l'homme.
Tr√®s commun, non insecte.`,

      "Pigeon": `üê¶ **Pigeon**
Oiseau urbain tr√®s adaptable.
Tr√®s commun en ville, non insecte.`
    };

    // === CONFIGURATION DU JEU ===
    const gameConfig = {
      facile: { choices: 4, rounds: 5 },
      moyen: { choices: 6, rounds: 7 },
      difficile: { choices: 8, rounds: 10 }
    };

    // Variables de jeu
    let score = 0;
    let correctStreak = 0;
    let wrongStreak = 0;
    let currentRound = 0;
    let totalRounds = 0;
    let currentLevel = '';
    let usedEndangered = [];
    let roundAnswered = false; // Protection contre les clics multiples

    const scoreDisplay = document.getElementById('scoreDisplay');
    const infoDiv = document.getElementById('info');
    const levelButtons = document.getElementById('level-buttons');
    const messageDiv = document.getElementById('message');
    const gameArea = document.getElementById('gameArea');
    const nextButton = document.getElementById('nextButton');

    // === FONCTIONS UTILITAIRES ===
    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    function getImagePath(speciesName) {
      // Mapping direct pour √©viter les erreurs de normalisation
      const imageMapping = {
        // Esp√®ces menac√©es
        "M√©lib√©e": "melibee.jpg",
        "Vanesse des pari√©taires": "vanesse-des-parietaires.jpg", 
        "Agrion bleuissant": "agrion-bleuissant.jpg",
        "Cordulie splendide": "cordulie-splendide.jpg",
        "Serratella mesoleuca": "serratella-mesoleuca.jpg",
        "Halictus carinthiacus": "halictus-carinthiacus.jpg",
        "Bourdon velout√©": "bourdon-veloute.jpg",
        "Criquet de la Crau": "criquet-de-la-crau.jpg",
        "Phasme du palmiste rouge": "phasme-du-palmiste-rouge.jpg",
        "Dendrobias maxillosus": "dendrobias-maxillosus.jpg",
        
        // Esp√®ces communes
        "Chauve-souris frugivore": "chauve-souris-frugivore.jpg",
        "Colibri": "colibri.jpg",
        "Mouche domestique": "mouche-domestique.jpg",
        "Fourmi noire": "fourmi-noire.jpg",
        "Papillon commun": "papillon-commun.jpg",
        "Abeille domestique": "abeille-domestique.jpg",
        "Sauterelle verte": "sauterelle-verte.jpg",
        "Scarab√©e commun": "scarabee-commun.jpg",
        "Coccinelle √† sept point": "coccinelle-a-sept-point.jpg",
        "Termite des for√™ts": "termite-des-forets.jpg",
        "Grillon champ√™tre": "grillon-champetre.jpg",
        "Larve de coccinelle": "larve-de-coccinelle.jpg",
        "Cicadelle": "cicadelle.jpg",
        "Lucane cerf volant": "lucane-cerf-volant.jpg",
        "Punaise verte": "punaise-verte.jpg",
        "Mite des v√™tements": "mite-des-vetements.jpg",
        "Perce-oreille": "perce-oreille.jpg",
        "Loup": "loup.jpg",
        "Renard": "renard.jpg",
        "Chat": "chat.jpg",
        "Chien": "chien.jpg",
        "Pigeon": "pigeon.jpg"
      };
      
      // Retourner le nom de fichier exact ou un fallback
      const fileName = imageMapping[speciesName];
      if (fileName) {
        return `images/${fileName}`;
      }
      
      // Fallback avec normalisation si pas trouv√© dans le mapping
      const normalizedName = speciesName
        .toLowerCase()
        .replace(/\s+/g, '-')
        .replace(/√©/g, 'e')
        .replace(/√®/g, 'e')  
        .replace(/√†/g, 'a')
        .replace(/√ß/g, 'c')
        .replace(/√¥/g, 'o')
        .replace(/'/g, '')
        .replace(/[^a-z0-9\-]/g, '');
      
      return `images/${normalizedName}.jpg`;
    }

    // === D√âMARRAGE DU JEU ===
    function startGame(level) {
      currentLevel = level;
      currentRound = 0;
      score = 0;
      correctStreak = 0;
      wrongStreak = 0;
      usedEndangered = [];
      
      totalRounds = gameConfig[level].rounds;
      
      levelButtons.style.display = 'none';
      scoreDisplay.style.display = 'block';
      updateScore();
      infoDiv.innerHTML = '';
      
      showRound();
    }

    // === AFFICHAGE D'UNE MANCHE ===
    function showRound() {
      roundAnswered = false; // Reset du flag pour la nouvelle manche
      infoDiv.innerHTML = '';
      nextButton.style.display = 'none';
      messageDiv.textContent = `Manche ${currentRound + 1}/${totalRounds}`;
      messageDiv.className = 'message';
      
      // Choisir un intrus qui n'a pas encore √©t√© utilis√©
      const availableEndangered = endangeredSpecies.filter(species => !usedEndangered.includes(species));
      if (availableEndangered.length === 0) {
        // Si tous ont √©t√© utilis√©s, on recommence la liste
        usedEndangered = [];
      }
      
      const intrus = availableEndangered[Math.floor(Math.random() * availableEndangered.length)];
      usedEndangered.push(intrus);
      
      // Choisir les d√©coys
      const nbChoices = gameConfig[currentLevel].choices;
      const choices = shuffle(commonSpecies).slice(0, nbChoices - 1);
      
      // M√©langer tous les √©l√©ments
      const items = shuffle([...choices, intrus]);
      
      // Appliquer la classe CSS correspondante
      gameArea.className = `game-area choices-${nbChoices}`;
      
      // Afficher les cartes
      gameArea.innerHTML = '';
      items.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.style.animationDelay = `${index * 0.05}s`;
        
        // Container pour l'image
        const imgContainer = document.createElement('div');
        imgContainer.style.flex = '1';
        imgContainer.style.display = 'flex';
        imgContainer.style.alignItems = 'center';
        imgContainer.style.justifyContent = 'center';
        imgContainer.style.height = '70%'; // Limiter la hauteur pour laisser place au nom
        
        // Image
        const img = document.createElement('img');
        img.src = getImagePath(item);
        img.alt = item;
        img.onerror = function() {
          // Si .jpg ne marche pas, essayer .png
          const normalizedName = item
            .toLowerCase()
            .replace(/\s+/g, '-')
            .replace(/√©/g, 'e')
            .replace(/√®/g, 'e')
            .replace(/√†/g, 'a')
            .replace(/√ß/g, 'c')
            .replace(/√¥/g, 'o')
            .replace(/'/g, '')
            .replace(/[^a-z0-9\-]/g, '');
          const pngPath = `images/${normalizedName}.png`;
          if (this.src !== pngPath) {
            this.src = pngPath;
          } else {
            // Si aucun format ne marche, afficher le placeholder
            imgContainer.innerHTML = `<div style="text-align:center; font-size:0.8em; color:#666;">üì∑<br>Image manquante</div>`;
          }
        };
        imgContainer.appendChild(img);
        
        // Nom de l'esp√®ce
        const nameDiv = document.createElement('div');
        nameDiv.className = 'item-name';
        nameDiv.textContent = item;
        nameDiv.style.height = '30%'; // Hauteur fixe pour le nom
        nameDiv.style.display = 'flex';
        nameDiv.style.alignItems = 'center';
        nameDiv.style.justifyContent = 'center';
        
        div.appendChild(imgContainer);
        div.appendChild(nameDiv);
        div.onclick = () => handleClick(item, intrus);
        gameArea.appendChild(div);
      });
    }

    // === GESTION DU CLIC ===
    function handleClick(item, intrus) {
      // Protection contre les clics multiples
      if (roundAnswered) return;
      
      roundAnswered = true;
      
      // D√©sactiver tous les boutons
      const allItems = document.querySelectorAll('.item');
      allItems.forEach(itemEl => {
        itemEl.style.pointerEvents = 'none';
        itemEl.style.opacity = '0.7';
      });
      
      // Afficher les informations sur l'esp√®ce
      const detailImg = `<img src="${getImagePath(item)}" alt="${item}">`;
      const textContent = `<div class="info-text">${definitions[item]}</div>`;
      infoDiv.innerHTML = detailImg + textContent;
      
      if (item === intrus) {
        // Bonne r√©ponse !
        wrongStreak = 0;
        correctStreak++;
        const bonus = 10 + correctStreak * 2; // 12, 14, 16...
        score += bonus;
        messageDiv.textContent = `‚úÖ Bravo ! Esp√®ce prot√©g√©e : ${item} (+${bonus} pts)`;
        messageDiv.className = 'message success';
        
        currentRound++;
        updateScore();
        
        // Afficher le bouton suivant ou finir
        if (currentRound < totalRounds) {
          nextButton.style.display = 'block';
        } else {
          setTimeout(() => {
            finishGame();
          }, 2000);
        }
        
      } else {
        // Mauvaise r√©ponse
        correctStreak = 0;
        wrongStreak++;
        const penalty = wrongStreak * 3;
        score = Math.max(0, score - penalty);
        messageDiv.textContent = `‚ùå ${item} n'est pas une esp√®ce √† prot√©ger (-${penalty} pts)`;
        messageDiv.className = 'message error';
        updateScore();
        
        // Afficher le bouton suivant pour continuer
        nextButton.style.display = 'block';
      }
    }

    // === FONCTION POUR PASSER √Ä LA MANCHE SUIVANTE ===
    function nextRound() {
      if (currentRound < totalRounds) {
        showRound();
      } else {
        finishGame();
      }
    }

    // === FIN DE PARTIE ===
    function finishGame() {
      gameArea.innerHTML = '';
      nextButton.style.display = 'none';
      
      let performance = '';
      if (score >= totalRounds * 10) performance = 'üèÜ Excellent !';
      else if (score >= totalRounds * 7) performance = 'ü•á Tr√®s bien !';
      else if (score >= totalRounds * 5) performance = 'ü•à Bien !';
      else performance = 'ü•â √Ä am√©liorer !';
      
      messageDiv.innerHTML = `
        <div style="font-size: 1.2em; margin-bottom: 8px;">${performance}</div>
        <div>Score final : ${score} points</div>
        <div style="font-size: 0.85em; margin-top: 8px;">
          Merci d'avoir jou√© pour la protection de la biodiversit√© !
        </div>
      `;
      messageDiv.className = 'message success';
      
      infoDiv.innerHTML = '';
      levelButtons.style.display = 'flex';
      scoreDisplay.style.display = 'none';
    }

    // === MISE √Ä JOUR DU SCORE ===
    function updateScore() {
      scoreDisplay.textContent = `Score : ${score}`;
    }
  </script>
</body>
</html>
